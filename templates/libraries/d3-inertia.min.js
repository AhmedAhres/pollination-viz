(function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("d3-drag"),require("d3-selection"),require("d3-timer")):"function"==typeof define&&define.amd?define(["exports","d3-drag","d3-selection","d3-timer"],t):t(e.d3=e.d3||{},e.d3,e.d3,e.d3)})(this,function(e,t,r,i){"use strict";function o(e){var t,r,i,o,s,a,c=n({start:function(){t=versor.cartesian(projection.invert(c.position)),r=projection.rotate(),i=versor(r),e.start&&e.start()},move:function(){var o=projection.rotate(r).invert(c.position);if(!isNaN(o[0])){var n=versor.cartesian(o),s=versor.multiply(i,versor.delta(t,n)),a=versor.rotation(s);e.render(a),e.move&&e.move()}},end:function(){o=versor.cartesian(projection.invert(c.position.map(function(e,t){return e-c.velocity[t]/1e3}))),a=versor(projection.rotate()),s=versor.cartesian(projection.invert(c.position)),e.end&&e.end()},render:function(t){var r=versor.rotation(versor.multiply(a,versor.delta(o,s,1e3*t)));e.render&&e.render(r)},time:e.time});return c}function n(e){var t=e.time||5e3,o=-Math.log(1-1/1.0001),n={start:function(){var t=r.mouse(this);n.position=t,n.velocity=[0,0],n.timer&&(n.timer.stop(),n.timer=null,this.classList.remove("inertia")),this.classList.add("dragging"),e.start&&e.start.call(this,t)},move:function(){var t=r.mouse(this),i=performance.now(),o=i-n.time,s=1-Math.exp(-o/1e3);n.velocity=n.velocity.map(function(e,r){var o=t[r]-n.position[r],a=i-n.time;return 1e3*(1-s)*o/a+e*s}),n.time=i,n.position=t,e.move&&e.move.call(this,t)},end:function(){var r=n.velocity;if(r[0]*r[0]+r[1]*r[1]<100)return n.timer=null,this.classList.remove("inertia");this.classList.remove("dragging"),this.classList.add("inertia"),e.end&&e.end();var s=this;n.timer=i.timer(function(r){n.t=1.0001*(1-Math.exp(-o*r/t)),e.render&&e.render(n.t),n.t>1&&(n.timer.stop(),n.timer=null,s.classList.remove("inertia"),n.velocity=[0,0],n.t=1)})},position:[0,0],velocity:[0,0],timer:null,time:0};return n}e.geoInertiaDragHelper=o,e.geoInertiaDrag=function(e,r,i,n){i||"function"!=typeof projection||(i=projection),n||(n={});var s=o({projection:i,render:function(e){i.rotate(e),r&&r()},start:n.start,move:n.move,end:n.end,time:n.time});return e.call(t.drag().on("start",s.start).on("drag",s.move).on("end",s.end)),s},e.inertia=n,Object.defineProperty(e,"__esModule",{value:!0})});